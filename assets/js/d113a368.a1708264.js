"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[539],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var o=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,o,l=function(e,n){if(null==e)return{};var t,o,l={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),p=c(t),m=l,h=p["".concat(s,".").concat(m)]||p[m]||d[m]||a;return t?o.createElement(h,i(i({ref:n},u),{},{components:t})):o.createElement(h,i({ref:n},u))}));function h(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,i=new Array(a);i[0]=m;var r={};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);r.originalType=e,r[p]="string"==typeof e?e:l,i[1]=r;for(var c=2;c<a;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},9022:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var o=t(7462),l=(t(7294),t(3905));const a={},i="Local actions",r={unversionedId:"ansible/local-actions",id:"ansible/local-actions",title:"Local actions",description:"Single module",source:"@site/docs/ansible/local-actions.md",sourceDirName:"ansible",slug:"/ansible/local-actions",permalink:"/docs/ansible/local-actions",draft:!1,editUrl:"https://github.com/agarthetiger/docusaurus/tree/main/docs/ansible/local-actions.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Inventory Plugins",permalink:"/docs/ansible/inventory-plugins"},next:{title:"Lookup Plugins",permalink:"/docs/ansible/lookup-plugins"}},s={},c=[{value:"Single module",id:"single-module",level:2},{value:"Local actions",id:"local-actions-1",level:2},{value:"Localhost and non-SSH connections",id:"localhost-and-non-ssh-connections",level:2}],u={toc:c};function p(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"local-actions"},"Local actions"),(0,l.kt)("h2",{id:"single-module"},"Single module"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"ansible all -m setup -i 192.168.0.11,\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"ansible all")," execute ansible against host group 'all'    "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-m setup")," run the setup module to gather information about the hosts"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"-i 192.168.0.11,")," inline host list, must be comma-separated list of hosts so add training comma for a single host.")),(0,l.kt)("p",null,"See ",(0,l.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/modules/setup_module.html#examples"},"Examples")," on the Ansible Setup module documentation."),(0,l.kt)("h2",{id:"local-actions-1"},"Local actions"),(0,l.kt)("p",null,"If you want to run a playbook and always do things locally, execute the playbook using ",(0,l.kt)("inlineCode",{parentName:"p"},"--connection=local")," on the command line or ",(0,l.kt)("inlineCode",{parentName:"p"},"connection: local")," on the play. This instructs ansible not to establish an SSH connection. This is useful if local loobpack is disabled eg. due to firewall rules or security groups. "),(0,l.kt)("p",null,"To run a playbook which uses ",(0,l.kt)("inlineCode",{parentName:"p"},"- hosts: all")," or similar, pass an inventory with just localhost or 127.0.0.1 and connection=local"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"ansible-playbook -i 127.0.0.1, --connection=local myplaybook.yaml\n")),(0,l.kt)("p",null,"Alternatively, within a playbook with tasks to be executed remotely, include a section with "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"- hosts: 127.0.0.1\n  connection: local\n")),(0,l.kt)("p",null,"More alternatives include using the ",(0,l.kt)("inlineCode",{parentName:"p"},"local_action")," module which is a shorthand syntax for  the ",(0,l.kt)("inlineCode",{parentName:"p"},"delegate_to: 127.0.0.1")," option. Combine these with ",(0,l.kt)("inlineCode",{parentName:"p"},"run_once: true")," to ensure things running locally only happen once if that's what you want (like downloading a file once to then use Ansible to push the file to multiple hosts). "),(0,l.kt)("p",null,"See Ansible documentation on ",(0,l.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_delegation.html#delegation"},"Delegation")," This is useful to switch to running selected tasks locally in the middle of a role execution for example, where you cannot add hosts: directives to switch between local and remote execution."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'- hosts: all\n  gather_facts: false\n  tasks:\n  - name: ensure required parameters have been set\n    fail: msg="Variable \'{{ item }}\' is not defined"\n    when: item not in vars\n    with_items:\n      - public_key_file\n      - host_user_id\n    run_once: true\n  - name: locate public key file\n    local_action:\n      module: stat\n      path: "{{ public_key_file }}"\n    register: keyFile\n    run_once: true\n')),(0,l.kt)("h2",{id:"localhost-and-non-ssh-connections"},"Localhost and non-SSH connections"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ansible_connection=local")," can be used in the inventory or on the command line to specify how Ansible will connect to the target host. In the case of local actions you can use ansible_connection=local as an inventory parameter with localhost to execute something locally even if you don't have a local loopback connection. The equivalent in a playbook is ",(0,l.kt)("inlineCode",{parentName:"p"},"connection: local"),"."),(0,l.kt)("p",null,"Note localhost will be recognised by Ansible as a valid host if the /etc/hosts file has an entry for 127.0.0.1 localhost or if ",(0,l.kt)("inlineCode",{parentName:"p"},"localhost 127.0.0.1 ansible_connection=local")," is specified in the inventory, otherwise use 127.0.0.1."))}p.isMDXComponent=!0}}]);