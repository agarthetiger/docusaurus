"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9154],{3905:(e,r,t)=>{t.d(r,{Zo:()=>c,kt:()=>f});var n=t(7294);function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?o(Object(t),!0).forEach((function(r){i(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function a(e,r){if(null==e)return{};var t,n,i=function(e,r){if(null==e)return{};var t,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(i[t]=e[t]);return i}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=n.createContext({}),p=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},c=function(e){var r=p(e.components);return n.createElement(l.Provider,{value:r},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},h=n.forwardRef((function(e,r){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=p(t),h=i,f=u["".concat(l,".").concat(h)]||u[h]||d[h]||o;return t?n.createElement(f,s(s({ref:r},c),{},{components:t})):n.createElement(f,s({ref:r},c))}));function f(e,r){var t=arguments,i=r&&r.mdxType;if("string"==typeof e||i){var o=t.length,s=new Array(o);s[0]=h;var a={};for(var l in r)hasOwnProperty.call(r,l)&&(a[l]=r[l]);a.originalType=e,a[u]="string"==typeof e?e:i,s[1]=a;for(var p=2;p<o;p++)s[p]=t[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},2592:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>p});var n=t(7462),i=(t(7294),t(3905));const o={},s="Pipeline DSL Notes",a={unversionedId:"jenkins/PipelineDSL",id:"jenkins/PipelineDSL",title:"Pipeline DSL Notes",description:"Groovy closures",source:"@site/docs/jenkins/PipelineDSL.md",sourceDirName:"jenkins",slug:"/jenkins/PipelineDSL",permalink:"/docusaurus/docs/jenkins/PipelineDSL",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/jenkins/PipelineDSL.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Jenkins Plugins",permalink:"/docusaurus/docs/jenkins/JenkinsPlugins"},next:{title:"Pipeline Steps",permalink:"/docusaurus/docs/jenkins/PipelineSteps"}},l={},p=[{value:"Groovy closures",id:"groovy-closures",level:2},{value:"Script approvals from libraries",id:"script-approvals-from-libraries",level:2}],c={toc:p};function u(e){let{components:r,...t}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,t,{components:r,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"pipeline-dsl-notes"},"Pipeline DSL Notes"),(0,i.kt)("h2",{id:"groovy-closures"},"Groovy closures"),(0,i.kt)("p",null,"There has been a ",(0,i.kt)("a",{parentName:"p",href:"https://issues.jenkins-ci.org/browse/JENKINS-26481"},"long-standing bug")," with using closures like ",(0,i.kt)("inlineCode",{parentName:"p"},".each{}")," on collections, where the behaviour was incorrect and inconsistent. This ",(0,i.kt)("a",{parentName:"p",href:"https://gist.github.com/oifland/ab56226d5f0375103141b5fbd7807398"},"gist")," demonstrates some of this behaviour. The bug has now been ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/jenkins-infra/jenkins.io/commit/89792a0c8e0a3850f95ec5fe24bbc89f962fb7ed"},"fixed")," in plugin:workflow-cps 2.33 although it's worth noting that there may still be other bugs like ",(0,i.kt)("a",{parentName:"p",href:"https://issues.jenkins-ci.org/browse/JENKINS-46749"},"this")," which at the time of writing are still unresolved."),(0,i.kt)("h2",{id:"script-approvals-from-libraries"},"Script approvals from libraries"),(0,i.kt)("p",null,'If you are a non-admin user writing Jenkins shared libraries, note that non-whitelisted methods will be blocked with an error indicating a script approval is required. Unfortunately library code does not raise a script approval for an admin to approve and the code in question has to be added to a Pipeline job where the methods are called directly from a Pipeline job using "Pipeline script" or "Pipeline Script from SCM". '),(0,i.kt)("p",null,"To address this, a pattern I have adopted is to include a Groovy Jenkinsfile in the shared library repository called script-approvals.groovy which makes all the method calls requiring approval. It is then easy to create a Jenkins job which executes this pipeline, which can be repeatedly executed by the team responsible for approving scripts until the script runs to completion. This is useful in environments where there are new or multiple Jenkins masters which a library will be used on."))}u.isMDXComponent=!0}}]);